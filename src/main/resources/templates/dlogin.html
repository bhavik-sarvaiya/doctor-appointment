<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kk's HOSPITAL | Welcome to KK's hospital doctor</title>
<link rel="stylesheet" type="text/css" href=""
	th:href="@{/css/styles.css}" />
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

</head>
<body>

	<header class="header2">
		<div class="container">
			<nav class="navbar">
				<h1 class="logo">
					<a th:href="@{/welcome}"><i class="fa-solid fa-hospital-user"></i>
						KK's </a>
				</h1>
				<ul class="nav-items">
					<li class="nav-item"><a th:href="@{/welcome}">Home</a></li>
					<li class="nav-item"><a th:href="@{/about}">About Us</a></li>
					<li class="nav-item"><a th:href="@{/contact}">Contact</a></li>
					<li class="nav-item" th:if="${username == null}"
						onclick="openForm()"><a>Login</a></li>
					<li class="nav-item" th:if="${username != null}"><span
						style="color: white">Welcome, <span th:text="${username}"></span></span>
					</li>
					<li class="nav-item" th:if="${username != null}"><a
						th:href="@{/logout}">logout</a></li>
				</ul>
			</nav>

			<!-- <div class="Dform">
				<h1>
					Welcome to KK's hospital <span th:text="${doctor.name}"></span>.
				</h1>
			</div> -->
		</div>
	</header>
	<br>
	
	<label for="filterDate">Filter Appointments by Date:</label>
<input type="date" id="filterDate" onchange="filterAppointments()">
	<div id="table-container">
	
	
		<h2>Your today's appoinment</h2>
		<table class="doctor-data-table Appointment" id="Appointment">
			<thead>
				<tr>
					<th>Sr. No. <!-- <input type="text" class="filter" data-column="0"
						placeholder="Filter"> -->
					</th>
					<th>Date <!-- <input type="text" class="filter" data-column="1"
						placeholder="Filter"> -->
					</th>
					<th>Time <!-- <input type="text" class="filter" data-column="2"
						placeholder="Filter"> -->
					</th>
					<th>Name <!-- <input type="text" class="filter" data-column="3"
						placeholder="Filter"> -->
					</th>
					<th>Update</th>
					<th>Delete</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="appointment,apid : ${appointments}">
					<td th:text="${apid.index + 1}"></td>
					<td th:text="${appointment.appointmentDate}"></td>
					<td th:text="${appointment.appointmentSlot}"></td>
					<td th:text="${appointment.patient.name}"></td>
					<!-- <td>
						<form id="update"
							th:action="@{appointment/{id}(id=${appointment.id})}"
							method="post" style="display: none">
							<label for="patient">Patient:</label> <input name="patientName"
								th:value="${username}" readonly="readonly"><br> <input
								type="hidden" name="patientId" th:value="${userId}"><br>
							<br> <label for="doctor">Doctor:</label> <select
								name="doctorId" required>
								<option th:each="doctor : ${doctors}" th:value="${doctor.id}"
									th:text="${doctor.name}"></option>
							</select> <br> <br> <label for="appointmentDate">Appointment
								Date :</label> <input type="date" name="appointmentDate" required /> <label
								for="appointmentSlot">Select Appoinment Slot:</label> <select
								name="appointmentSlot" id="appointmentSlot" required>
								<option value="9AM-12PM">9AM-12PM</option>
								<option value="4PM-9PM">4PM-9PM</option>
							</select> <br> <br>

						</form>
						<button type="submit" onclick="hideForm()">Update</button> -->
						<td>
    <button class="update-btn" onclick="toggleUpdate(this)">
        <i class="fa-regular fa-circle"></i> <!-- Empty Circle -->
    </button>
</td>
					<!-- </td> -->
					<td>
						<form th:action="@{appointment/{id}/delete(id=${patient.id})}"
							method="post">
							<input type="hidden" name="_method" value="delete" />
							<button type="submit">Delete</button>
						</form>
					</td>
				</tr>
			</tbody>
		</table>
		<div class="pagination">
			<span th:if="${currentPage > 0}"> <a href="#"
				th:data-page="${currentPage - 1}" class="pagination-link">Previous</a>
			</span> <span th:if="${currentPage < totalPages - 1}"> <a href="#"
				th:data-page="${currentPage + 1}" class="pagination-link">Next</a>
			</span><br> <span>Page <span th:text="${currentPage + 1}"></span>
				of <span th:text="${totalPages}"></span>
			</span>
		</div>
	</div>

	<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
      /*   const table = document.getElementById('Appointment');
        const filters = document.querySelectorAll('.filter');
        const filterValues = {}; // Store filter values across page changes

        // Apply filters to the current rows
        function applyFilters() {
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                let isVisible = true;
                Object.keys(filterValues).forEach(column => {
                    const cell = row.cells[column];
                    const cellText = cell ? cell.textContent.toLowerCase() : '';
                    if (!cellText.includes(filterValues[column])) {
                        isVisible = false;
                    }
                });
                row.style.display = isVisible ? '' : 'none';
            });
        }

        // Save filters and reapply them
        function attachFilterListeners() {
            filters.forEach(filter => {
                const column = parseInt(filter.dataset.column, 10);
                filter.value = filterValues[column] || ''; // Restore previous filter values
                filter.addEventListener('keyup', function () {
                    filterValues[column] = this.value.toLowerCase();
                    applyFilters();
                });
            });
        }
 */
        // Fetch and load a new page
        
        function filterAppointments() {
    let selectedDate = document.getElementById("filterDate").value;
    let rows = document.querySelectorAll("#Appointment tbody tr");
    let today = new Date().toISOString().split("T")[0];
    document.getElementById("filterDate").value = today;
    filterAppointments();

    rows.forEach(row => {
        let appointmentDate = row.cells[1].textContent.trim(); // Assuming date is in 2nd column
        if (!selectedDate || appointmentDate === selectedDate) {
            row.style.display = "";
        } else {
            row.style.display = "none";
        }
    });
}
        
        function loadPage(page) {
            fetch(`/appointment/${page}`)
                .then(response => response.text())
                .then(data => {
                    document.getElementById('table-container').innerHTML = data;

                    // Reinitialize pagination and filters after the DOM update
                    attachPaginationListeners();
                    attachFilterListeners();
                    applyFilters(); // Reapply filters to the new page
                })
                .catch(error => console.error('Error fetching appointments:', error));
        }

        // Attach pagination listeners
        function attachPaginationListeners() {
            const paginationLinks = document.querySelectorAll('.pagination-link');
            paginationLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    loadPage(page);
                });
            });
        }

        // Initialize filters and pagination
     /*    attachFilterListeners(); */
        attachPaginationListeners();
     
        function toggleUpdate(button) {
            button.classList.toggle('green');
        }
    });
    
</script>


</body>
</html>
